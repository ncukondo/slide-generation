# AI Agent Integration Specification

## Overview

This specification defines the integration features that enable AI coding assistants (Claude Code, OpenCode, Cursor, Codex, etc.) to operate the `slide-gen` tool using natural language.

### Design Principles

1. **AgentSkills-centric architecture**: Common format usable across multiple AI Agents
2. **Single Agent configuration**: Simple structure without sub-agents
3. **English file descriptions**: Maximize token efficiency
4. **Progressive Disclosure**: Load details only when needed

### Supported AI Assistants

| Assistant | Configuration Files | AgentSkills Support |
|-----------|---------------------|---------------------|
| Claude Code | `.skills/`, `.claude/commands/`, `CLAUDE.md` | Yes |
| OpenCode | `.skills/`, `.opencode/agent/`, `AGENTS.md` | Yes |
| Cursor | `.skills/`, `.cursorrules` | Yes |
| Gemini CLI | `.skills/` | Yes |
| Codex | `.skills/` | Yes |

---

## File Structure

### Repository Root (on GitHub)

```
slide-generation/
├── AI-GUIDE.md              # AI Agent quick start (English)
├── CLAUDE.md                # Developer guide (existing)
└── ...
```

### Files Generated by `slide-gen init`

```
my-presentation/
├── .skills/
│   └── slide-assistant/
│       ├── SKILL.md              # AgentSkills format (common, English)
│       ├── references/
│       │   ├── templates.md      # Template details
│       │   └── workflows.md      # Workflow descriptions
│       └── scripts/
│           └── validate.sh       # Validation script
├── .claude/
│   └── commands/                 # Claude Code Slash Commands
│       ├── slide-create.md
│       ├── slide-validate.md
│       ├── slide-preview.md
│       ├── slide-screenshot.md
│       └── slide-theme.md
├── .opencode/
│   └── agent/
│       └── slide.md              # OpenCode sub-agent
├── AGENTS.md                     # OpenCode project guide (English)
├── CLAUDE.md                     # Claude Code project guide (English)
├── .cursorrules                  # Cursor (same as AGENTS.md)
├── config.yaml
├── presentation.yaml
└── ...
```

---

## AgentSkills Format (Common Foundation)

### .skills/slide-assistant/SKILL.md

```markdown
---
name: slide-assistant
description: Assists with slide creation using slide-gen CLI. Responds to requests like "create slides", "show templates", "convert manuscript to slides".
allowed-tools: Read Write Edit Bash Glob Grep
---

# Slide Assistant

Helps create Marp slides using the slide-gen CLI tool.

## Capabilities

1. **Project initialization**: `slide-gen init`
2. **Template discovery**: `slide-gen templates list --format llm`
3. **Slide creation**: Create/edit presentation.yaml
4. **Validation**: `slide-gen validate`
5. **Conversion**: `slide-gen convert`
6. **Screenshot**: `slide-gen screenshot` (for AI review)

## Workflow

### New Project

1. Run `slide-gen init <directory>` to initialize
2. Gather requirements from user
3. Check templates with `slide-gen templates list --format llm`
4. Create presentation.yaml
5. Validate and convert

### Existing Project

1. Read presentation.yaml
2. Edit according to user request
3. Validate and convert

## YAML Source Format

```yaml
meta:
  title: "Presentation Title"
  author: "Author Name"
  date: "YYYY-MM-DD"
  theme: "default"

slides:
  - template: title
    content:
      title: "Main Title"
      subtitle: "Subtitle"

  - template: bullet-list
    content:
      title: "Overview"
      items:
        - "Item 1"
        - "Item 2"
```

## Template Examples

### Title Slide
```yaml
- template: title
  content:
    title: "Title"
    subtitle: "Subtitle"
    author: "Author"
```

### Bullet List
```yaml
- template: bullet-list
  content:
    title: "Title"
    items:
      - "Item 1"
      - "Item 2"
```

### Cycle Diagram
```yaml
- template: cycle-diagram
  content:
    title: "PDCA Cycle"
    nodes:
      - { label: "Plan", icon: "planning", color: "#4CAF50" }
      - { label: "Do", icon: "action", color: "#2196F3" }
      - { label: "Check", icon: "analysis", color: "#FF9800" }
      - { label: "Act", icon: "improvement", color: "#9C27B0" }
```

## Commands Reference

| Command | Description |
|---------|-------------|
| `slide-gen convert <input>` | Convert YAML to Marp Markdown |
| `slide-gen validate <input>` | Validate source file |
| `slide-gen templates list` | List templates |
| `slide-gen templates info <name>` | Template details |
| `slide-gen icons search <query>` | Search icons |
| `slide-gen screenshot <input>` | Take screenshots |
| `slide-gen preview <input>` | Open preview in browser |

## AI-Optimized Output

Use `--format llm` for token-efficient output:
```bash
slide-gen templates list --format llm
slide-gen templates info <name> --format llm
```
```

### .skills/slide-assistant/references/templates.md

Detailed template information (loaded on demand).

### .skills/slide-assistant/references/workflows.md

Detailed descriptions of source collection flow and image collaboration flow.

---

## Claude Code Commands

### .claude/commands/slide-create.md

```markdown
Create slides from user requirements.

## Steps

1. Get manuscript/requirements from user
2. Check templates: `slide-gen templates list --format llm`
3. Select appropriate templates
4. Create or edit presentation.yaml
5. Validate: `slide-gen validate presentation.yaml`
6. Fix any errors
7. Convert: `slide-gen convert presentation.yaml -o slides.md`
8. Report results

## Notes

- Select appropriate template for each slide
- Search icons if needed: `slide-gen icons search`
- Fix all validation errors before conversion
```

### .claude/commands/slide-validate.md

```markdown
Validate slide source file.

## Command

```bash
slide-gen validate $ARGUMENTS
```

If no argument provided:
```bash
slide-gen validate presentation.yaml
```
```

### .claude/commands/slide-preview.md

```markdown
Preview slides in browser.

## Command

```bash
slide-gen preview $ARGUMENTS
```

If no argument provided:
```bash
slide-gen preview presentation.yaml
```

## Options

- `--gallery` or `-g`: Show thumbnail gallery of all slides
- `--slide <number>`: Preview specific slide
```

### .claude/commands/slide-screenshot.md

```markdown
Take screenshots of slides for AI review.

## Command

```bash
slide-gen screenshot $ARGUMENTS
```

If no argument provided:
```bash
slide-gen screenshot presentation.yaml -o screenshots/
```

## Options

- `--slide <number>`: Screenshot specific slide only
- `--width <pixels>`: Image width (default: 1280)
- `--output <dir>`: Output directory

## After Screenshot

Read the screenshot images to review slide content and provide feedback.
```

### .claude/commands/slide-theme.md

```markdown
Adjust slide theme and styling.

## Steps

1. Read current theme settings (themes/custom.css)
2. Confirm user requirements
3. Edit CSS
4. Regenerate: `slide-gen convert`
5. Take screenshot: `slide-gen screenshot`
6. Review and report to user

## Adjustable Items

- Background color
- Font family and size
- Heading styles
- Color scheme
- Margins and layout
```

---

## OpenCode Configuration

### .opencode/agent/slide.md

```yaml
---
description: Slide creation assistant using slide-gen CLI
mode: subagent
tools:
  write: allow
  edit: allow
  bash: allow
  read: allow
permission:
  file_edit: allow
  bash: allow
---

# Slide Assistant

You are a slide creation assistant that uses the slide-gen CLI tool.

## Available Commands

| Command | Description |
|---------|-------------|
| `slide-gen convert <input>` | Convert YAML to Marp Markdown |
| `slide-gen validate <input>` | Validate source file |
| `slide-gen templates list --format llm` | List templates (AI format) |
| `slide-gen icons search <query>` | Search icons |
| `slide-gen screenshot <input>` | Take screenshots |

## Workflow

1. Understand user requirements
2. Check available templates
3. Create/edit presentation.yaml
4. Validate and fix errors
5. Convert to Marp Markdown
6. Take screenshots for review

## YAML Format

```yaml
meta:
  title: "Title"
  author: "Author"

slides:
  - template: title
    content:
      title: "Main Title"
```
```

### AGENTS.md (Project Root)

```markdown
# Slide Generation Project

This project uses slide-gen to create Marp slides from YAML source files.

## Quick Start

```bash
# Validate
slide-gen validate presentation.yaml

# Convert
slide-gen convert presentation.yaml -o slides.md

# Preview
slide-gen preview presentation.yaml
```

## Commands

| Command | Description |
|---------|-------------|
| `slide-gen convert <input>` | Convert YAML to Marp Markdown |
| `slide-gen validate <input>` | Validate source file |
| `slide-gen templates list` | List available templates |
| `slide-gen templates info <name>` | Get template details |
| `slide-gen icons search <query>` | Search for icons |
| `slide-gen preview <input>` | Preview in browser |
| `slide-gen screenshot <input>` | Take screenshots |

## AI-Optimized Output

For token-efficient output, use `--format llm`:
```bash
slide-gen templates list --format llm
slide-gen templates info bullet-list --format llm
```

## Project Structure

- `presentation.yaml` - Slide source file
- `config.yaml` - Project configuration
- `themes/` - Custom themes
- `icons/custom/` - Custom icons

## Skills

This project includes AgentSkills at `.skills/slide-assistant/`.
Read `.skills/slide-assistant/SKILL.md` for detailed instructions.
```

---

## AI-GUIDE.md (Repository Root)

File that AI assistants read when presented with a GitHub repository URL.

```markdown
# slide-gen AI Guide

This file is for AI assistants (Claude Code, OpenCode, Cursor, Codex, etc.).

## Quick Start

### 1. Initialize Project

```bash
npx @ncukondo/slide-generation init my-presentation
cd my-presentation
```

### 2. Available Commands

| Command | Description |
|---------|-------------|
| `slide-gen convert <input>` | Convert YAML to Marp Markdown |
| `slide-gen validate <input>` | Validate source file |
| `slide-gen templates list` | List templates |
| `slide-gen templates info <name>` | Template details |
| `slide-gen icons search <query>` | Search icons |
| `slide-gen preview <input>` | Preview in browser |
| `slide-gen screenshot <input>` | Take screenshots |

### 3. AI-Optimized Output

Use `--format llm` for token-efficient output:
```bash
slide-gen templates list --format llm
slide-gen templates info <name> --format llm
```

### 4. Slide Creation Workflow

1. Get manuscript/requirements from user
2. Check templates: `slide-gen templates list --format llm`
3. Create presentation.yaml
4. Validate: `slide-gen validate`
5. Convert: `slide-gen convert`
6. Preview or screenshot for review

### 5. YAML Source Format

```yaml
meta:
  title: "Title"
  author: "Author"
  date: "YYYY-MM-DD"
  theme: "default"

slides:
  - template: title
    content:
      title: "Main Title"
      subtitle: "Subtitle"

  - template: bullet-list
    content:
      title: "Overview"
      items:
        - "Item 1"
        - "Item 2"
```

## Detailed Specifications

- [Source Format](spec/source-format.md)
- [Templates](spec/templates.md)
- [CLI](spec/cli.md)
```

---

## Init Command Extension

### New Options

| Option | Description | Default |
|--------|-------------|---------|
| `--no-ai-config` | Do not generate AI Agent configuration | false |
| `--skip-marp-install` | Skip Marp CLI installation prompt | false |

### Generated Files

| File | Condition | Description |
|------|-----------|-------------|
| `.skills/slide-assistant/SKILL.md` | Default | AgentSkills format (common) |
| `.skills/slide-assistant/references/*.md` | Default | Detailed references |
| `CLAUDE.md` | Default | Claude Code guide |
| `AGENTS.md` | Default | OpenCode guide |
| `.cursorrules` | Default | Cursor (same as AGENTS.md) |
| `.claude/commands/*.md` | Default | Claude Code Slash Commands |
| `.opencode/agent/slide.md` | Default | OpenCode sub-agent |

---

## Source Material Collection Flow

AI collects information needed for slide creation based on user's material situation. See [sources.md](./sources.md) for details.

### Three Input Patterns

| Pattern | Situation | AI Behavior |
|---------|-----------|-------------|
| A: Exploration Mode | Detailed materials in a directory | Explore and analyze directory, auto-configure sources |
| B: Supplement Mode | Only scenario or partial materials | Analyze content, supplement missing info via interview |
| C: Interview Mode | No materials (starting from scratch) | Collect information via dialogue, configure sources |

---

## Image Collaboration Flow

Workflow for AI and user to collaborate on image preparation. See [images.md](./images.md) for details.

### Basic Principles

1. **Scenario-driven**: AI derives image requirements from presentation scenario
2. **Dynamic specification**: AI determines specs based on context
3. **Autonomous verification**: AI devises verification criteria from scenario

---

## Preview/Screenshot Features

### Command Roles

| Command | Purpose | Output | Primary User |
|---------|---------|--------|--------------|
| `screenshot` | Save image files | PNG files | AI |
| `preview` | Immediate browser display | Browser | User |

---

## Marp CLI Dependency Management

### Dependency Strategy

Marp CLI is managed as `optionalDependencies`.

### Feature Dependencies

| Feature | Marp CLI | Behavior |
|---------|----------|----------|
| `convert` (to MD) | Not required | Always works |
| `validate`, `templates`, `icons`, `init` | Not required | Always works |
| `preview` | Required | Works when installed |
| `screenshot` | Required | Works when installed |
| `convert -f pdf/html/pptx` | Required | Works when installed |

### Interactive Installation on Init

When running `slide-gen init`, explains Marp CLI necessity and offers automatic installation.

---

## Source Template Structure

AI configuration file templates are managed per-file in `src/cli/templates/ai/`.

```
src/cli/templates/ai/
├── index.ts                      # Export all
├── skill-md.ts                   # .skills/slide-assistant/SKILL.md
├── claude-md.ts                  # CLAUDE.md
├── agents-md.ts                  # AGENTS.md
├── opencode-agent.ts             # .opencode/agent/slide.md
├── references/
│   ├── index.ts
│   ├── templates-ref.ts          # references/templates.md
│   └── workflows-ref.ts          # references/workflows.md
├── scripts/
│   ├── index.ts
│   └── validate-sh.ts            # scripts/validate.sh
└── commands/
    ├── index.ts
    ├── slide-create.ts           # .claude/commands/slide-create.md
    ├── slide-validate.ts
    ├── slide-preview.ts
    ├── slide-screenshot.ts
    └── slide-theme.ts
```

Each file exports a single template generation function:

```typescript
// src/cli/templates/ai/skill-md.ts
export function generateSkillMd(): string {
  return `---
name: slide-assistant
description: Assists with slide creation using slide-gen CLI...
---
...`;
}
```

---

## Implementation Notes

1. **File generation never overwrites existing files**: Use `writeFileIfNotExists`
2. **AI-facing files are written in English**: Maximize token efficiency
3. **AgentSkills-centric architecture**: Common use across multiple Agents
4. **Skills descriptions should be specific**: Clear usage timing
5. **Leverage progressive disclosure**: SKILL.md body under 500 lines, details in references/
6. **Templates separated per file**: 1 file = 1 template function
